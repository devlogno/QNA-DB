{% extends "layout.html" %}
{% from 'partials/_macros.html' import render_question_card %}

{% block title %}Quiz Results{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <h1 class="text-3xl font-bold text-gray-100 mb-2">Quiz Results</h1>
    <p class="text-gray-400 mb-6">Completed on {{ exam.timestamp.strftime('%B %d, %Y') }}</p>

    <!-- Score Summary -->
    <div class="bg-gray-800 p-6 rounded-lg shadow-md border border-gray-700 mb-8 text-center">
        <p class="text-lg text-gray-300">Your Score</p>
        <p class="text-5xl font-bold text-green-400 my-2">{{ exam.score }} / {{ exam.total_questions }}</p>
        <p class="text-2xl font-semibold text-blue-400">{{ exam.accuracy }}% Accuracy</p>
    </div>

    <!-- Answer Review -->
    <h2 class="text-2xl font-bold text-gray-100 mb-4">Answer Review</h2>
    <div class="space-y-8">
        {% for answer in exam.answers.all() %}
            <div class="bg-gray-800 p-6 rounded-lg shadow-md border border-gray-700">
                <div class="question-block">
                    <div class="text-xl font-semibold mb-4 text-gray-100 flex items-start">
                        <span class="mr-2">{{ loop.index }}.</span>
                        <div class="flex-1">
                            {% if answer.question.question_image_url %}
                                <img src="{{ answer.question.question_image_url }}" alt="Question Image" class="max-w-full h-auto mb-2 rounded-lg">
                            {% endif %}
                            {{ answer.question.question_text | safe }}
                        </div>
                    </div>
                    <div class="options-container grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                        {% set options = ['A', 'B', 'C', 'D'] %}
                        {% for opt in options %}
                            {% set is_user_answer = answer.user_answer == opt %}
                            {% set is_correct_answer = answer.question.correct_answer == opt %}
                            <div class="flex items-center w-full text-left p-3 rounded-lg
                                {% if is_correct_answer %} bg-green-600 border-green-500 text-white
                                {% elif is_user_answer and not answer.is_correct %} bg-red-600 border-red-500 text-white
                                {% else %} bg-gray-700 border-gray-600 text-gray-300 {% endif %}">
                                <span class="w-6 h-6 flex-shrink-0 flex items-center justify-center rounded-full border border-current text-sm mr-3">{{ opt }}</span>
                                <div>
                                    {% set opt_img = answer.question['option_' + opt.lower() + '_image_url'] %}
                                    {% if opt_img %}
                                        <img src="{{ opt_img }}" class="max-w-full h-auto mb-1 rounded-lg">
                                    {% endif %}
                                    {{ answer.question['option_' + opt.lower()] | safe }}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
                <div class="mt-6 p-4 bg-gray-700 rounded-lg">
                    <h3 class="text-lg font-semibold mb-2 text-gray-200">Solution:</h3>
                    <p class="text-gray-300">{{ answer.question.solution | safe }}</p>
                </div>
            </div>
        {% endfor %}
    </div>
    
    <div class="mt-8 flex justify-center space-x-4">
        <a href="{{ url_for('quiz.create_quiz') }}" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg">Take Another Quiz</a>
        <a href="{{ url_for('routes.dashboard') }}" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-6 rounded-lg">Back to Dashboard</a>
    </div>
</div>
{% endblock %}
